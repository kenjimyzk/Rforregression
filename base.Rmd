---
title: "R Notebook"
output:
  html_document: default
  html_notebook: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, collapse=TRUE)
```


## R
### R のインストール

## RStudio 
### RStudio のインストール

### RStudio のつかい方
```{r}
getwd()
```

ワーキングディレクトリの指定は以下のようにする.
```
setwd(PATH)
```

RStudio の場合, プロジェクトとして管理するとそこが自動的にワーキングディレクトリになる.



## 基本
### 電卓としての R

R は電卓してとして使える. 
数値を扱う算術演算子として次のもとがある.

演算子  | 説明          | 例
------- | ------------- | ----------
`+`     | 足し算        | `5 + 2 = 7`
`-`     | 引き算        | `5 - 2 = 3`
`*`     | 掛け算        | `5 * 2 = 10`
`/`     | 割り算        | `5 / 2 = 2.5`
`^`, `**`| べき算        | `5 ^ 2 = 25`, `5 ** 2 = 25`
`%%`     | 割り算の余り | `5 %% 2 = 1`
`%/%`     | 割り算の切り下げ  | `5 %/% 2 = 2`

```{r}
5 + 2
5 - 2
5 * 2
5 / 2
5 ^ 2
5 ** 2
5 %% 2
5 %/% 2
```

### 関数電卓としてのR
R は関数として使える. たとえば以下の関数がある.

関数    | 説明          
------- | -------------
`sqrt()`    | 平方根 $\sqrt{\cdot}$    
`exp()`     | 指数    
`log()`     | 対数    
`factorial()`     | 順列    
`choose()`     | 組み合わせ    
`abs()`     | 絶対値    
`round()`   | 四捨五入    
`floor()`   | 切り下げ    
`ceiling()` | 切り上げ    

```{r}
sqrt(10)
exp(10)
log(10)
factorial(4)
choose(4,2)
abs(-10)
round(3.5)
floor(3.5)
ceiling(3.5)
```

関数の括弧無いに入る数値を引数という.
組み合せを計算する関数 `choose` の引数は2つある.
複数の引数は `,` で区切る.
引数の順序は指定すれば変更可能である.
```{r}
choose(4, 2)
choose(n=4, k=2)
choose(k=2, n=4)
```
また幾つかの引数は入力しなくても. デフォルトで設定してあることがある.
それぞれの関数のヘルプを確認されたい.

関数のヘルプはコマンド `sqrt` の場合
```
help(sqrt)
?sqrt
```
で調べることができる.


### R の型
Rにおいて値は型 (type) をもち, 型として数値 (numeric) と文字列 (character) と論理値 (logical) など^[他にも日付 (Date) やバイナリ (raw) がある.]がある.
多くの言語とちがい, 予め宣言する必要なく, 自動的に決定される.

数値には整数 (integer) と, 実数をコンピュータ的に扱っている倍数精度小数 (double) など^[他にも複素数 (complex) がある.]がある.
整数が倍数精度小数かは自動的に振り分けられるが, 明示的に数字の後に `L` をつけることもある.

文字は ダブルクオーテーション (") もしくは シングルクォーテーション (') で区切られる. 
`TRUE` もしくは `FALSE` を取る値を論理値 (logical) という. 省略して `T` と `F` とあわらせることもできるが混乱するので個人的に推奨しない. 

値の型は関数 `typeof()` で確認できる.
```{r}
typeof(3)
typeof(3L)
typeof("3")
typeof(TRUE)
typeof(FALSE)
typeof(T)
typeof(F)
```

特殊な値として, 無限大を意味する `Inf`, 非数を意味する `NaN`, 欠損値を意味する `NA` , 空を意味する `NULL` がある.
`Inf` と `Nan` の型は数値として分類され, `NA` の型は論理値として分類される.
また `NULL` は `NULL` という特別な型である.
```{r}
1/0
typeof(1/0)
0/0
typeof(0/0)
typeof(NA)
typeof(NULL)
```


### 変数
値は変数 (variable) に代入することによって再利用が可能になる.
Rでは代入のことを付値 (assign) といい, 以下のように実行される.
```{r}
x <- 4 
4 -> x
x = 4
assign("x",4)
```
多くのプログラム言語では3番目のやり方をだけであるが,
R では最初のやり方を推奨している.
例えば以下を参照されたい:  
http://adv-r.had.co.nz/Style.html

代入した値を確認するには単にその変数を入力すればよい.
代入と同時に確認するには丸括弧をつけるとよい.
```{r}
x
(x<-3)
```

付値される変数として, 記号と数字からはじまらなければ, ほぼ自由に作れる.
アルファベットについて大文字と小文字が区別されることに注意されたい.
また日本語も変数に使えるが, 機種によって文字コードが違うため, 避けて使うほうが望ましい.

扱える変数は `if` などいくつか^[`break, else, FALSE, for, function, if in Inf, NA, NaN, next NULL, repeat, TRUE, while` など]はエラーになるが,
 `pi` のようにすでに組み込まれている変数も変更して指定することができる.
```{r}
pi
pi <- 3
pi
```

関数 `objects()` を使うことで，現在どんなオブジェクトがあるかを調べられる．
また，前に定義したオブジェクトを消す場合 `rm()` を用いる．
すでに組み込まれた変数を上書きした `pi` を削除するともとの変数が復活する.
```{r}
rm(pi)
pi
```

さらに，全てのオブジェクトを消す場合は `rm(list=ls(all=TRUE))` とすればよい．

## ベクトル1
### ベクトル
値を集めたものをベクトルという.
ベクトルは `c()` を用いて構成する. 
```{r}
(num<-c(2,3,7,9))
(chr <- c("cat","dog","cow"))
```

型が同じ値によって構成される. 

ベクトルには長さという属性 (attribute) が付く.
```{r}
length(num)
length(chr)
```
ベクトルはオブジェクトの基本であり, 一つの値は長さが1のベクトルと考える.

型が同じでない場合, 強制的に同じ型に変換される.
文字列が含まれればすべて文字列になる.
数値と論理値の場合は論理値の `TRUE` が1に `FALSE` が0に変換される.

```{r}
(x<- c(1,4))
typeof(x)
(y <- c(2,FALSE,"4"))
typeof(y)
(z <- c(2,FALSE))
typeof(z)
```




### 算術演算子
四則演算などの算術演算子はその対象を数値ベクトルに拡張できる.
ベクトルの算術演算子はその要素ごと行う.
```{r}
a<-c(2,3,3,3)
b<-c(3,3,5,7)
a+b
a-b
a*b
a/b
a^b
```

片方が値, 同じ長さのベクトルとして演算が実行される.
```{r}
a+2
a-2
a*2
a/2
a^2
```

一般に長さが違う場合, 短いほうが繰り返される.
```{r}
c<-c(1,2)
a+c
a-c
a*c
a/c
a^c
```
なお 短いほうが長い方の約数でないと警告がでる.


### 論理演算子
論理値に対して演算をおこなって論理値を返す論理演算子というものがある.
Rには, 論理演算子として, 否定 (`!`), または (`|`), かつ (`&`) がある.
論理演算子もベクトルごとに評価できる.

```{r}
logic1 <- c(TRUE, FALSE, FALSE)
logic2 <- c(TRUE, TRUE, FALSE)
!logic1
logic1 | logic2
logic1 & logic2
```

ベクトルのうちすべての要素が `TRUE` かどうかを評価する `all` や
少なくとも一つの要素が `TRUE` かどうかを評価する `any` というのがある.
,
```{r}
any(logic1)
all(logic1)
```


### 比較演算子
2つの値を比較してして論理値を返す比較演算子というものがある.
Rには, 比較演算子として, 等しいか `==`, どちらかが大きいか `>`,  `<` がある.
それぞれのベクトルの要素ごとに評価できる.
```{r}
vec1 <- 1:4
vec2 <- c(2,1,3,4)
vec1 == vec2
vec1 > vec2
vec1 < vec2
```

他にも等しくない `!=`, 以上および以下 `>=`, `<=` がある.
```{r}
vec1 != vec2 # !(vec1==vec2)
vec1 >= vec2 # (vec1 > vec2 | vec1 == vec2)
vec1 <= vec2 # (vec1 < vec2 | vec1 == vec2)
```

片方が値, 同じ長さのベクトルとして演算が実行される.
```{r}
vec1 > 2
```

### 要素
ベクトルの要素はカギカッコで取り出す.
```{r}
num <- c(2,3,7,9)
num[3]
```

取り出すだけななく付値することもできる.
```{r}
num[3] <- 500
num
```

マイナスをつけるとその要素以外を取り出す.
```{r}
num[-3]
```

複数取り出すこともできる.
```{r}
num[c(1,4)]
```

他にも論理値ベクトルを使って取り出すことができる.
```{r}
idx <- c(TRUE,FALSE,TRUE,TRUE)
num[idx]
```

さらに比較演算子と組み合わせることができる.
```{r}
(num > 4)
num[num > 4]
```

また `:` をもちいて連続したベクトルが作れるので, それを利用してベクトルを抜き出すことができる.
```{r}
2:4
num[2:4]
```


## ベクトル2
### 関数
引数がベクトルの関数がいくつかある. 
これによってベクトルの和や積が簡単に扱える.
```{r}
x<-c(1,2,3,4,5)
sum(x)
cumsum(x)
prod(x)
cumprod(x)
```

平均, 中央値, 分散, 標準偏差などの統計関数も扱える.
```{r}
x <- c(x,10)
mean(x)
median(x)
var(x)
sd(x)
```

ベクトルを並べ替えたり
最小値や最大値しめしたり, それが何番目の要素になるのかをしめすことができる.
```{r}
x <- c(3,3,5,0)
sort(x)
sort(x,decreasing = TRUE)
min(x)
max(x)
which.min(x)
which.max(x)
```

またベクトルに `NA` が含まれるき, 関数 `mean` などではデフォルトで結果が, `NA` になる.
それを避けるには `na.rm=TRUE` というオプションを付ける必要がある.

```{r}
x <- c(4,2,NA,3)
mean(x)
mean(x, na.rm = TRUE)
```

### 規則的なベクトル
`1:5` のような規則的なベクトルを柔軟に作成するのに `seq` を用いるとよい.
```{r}
1:5
seq(1, 5)
seq(1, 5, by = 2)
seq(1, 5, length.out = 4)
```

繰り返しを作成することができる `rep` も覚えておくと便利である.
```{r}
rep(1, 5)
rep(c(1, 2), times = 3)
rep(c(1, 2), each = 3)
```

またアルファベットの文字列もあらかじめ組み込まれている.
```{r}
letters
LETTERS
LETTERS[1:2]
```

### 乱数ベクトル
ベクトルを出鱈目に並べ直すには関数 `sample` を使う
```{r}
set.seed(10)
sample(1:5)
```
最初の行の関数 `set.seed` は他の環境でも再現可能性にするための設定である.


さて, この乱数は一旦出力された値は二度とでない非復元抽出である.
復元抽出にするには
```{r}
sample(1:5, replace=TRUE)
```
とオプション `replace=TRUE` をつける.

いくつ取り出すかをオプション `size` で決められる.
```{r}
sample(LETTERS[1:2], size=10, replace=TRUE)
```
非復元抽出の場合, 取りうる値より大きくできないことに注意されたい.

さらに確率を `prob` で変えることができる. 
```{r}
sample(LETTERS[1:2], prob=c(0.8,0.2),size=10,replace=TRUE)
```

独立な一様分布にしたがう長さ `size` のベクトルは `runif(size)` によって, 正規分布にしたがうベクトルは `rnorm(size)` で出力される.
```{r}
size <- 8
runif(size)
rnorm(size)
```

### 因子ベクトル
文字列ベクトルを引数にした関数 `factor`によって 因子 (factor) ベクトルを作成できる.
```{r}
(x <- c("L","S","M","M","L"))
(x.fac <- factor(x))
```

因子ベクトルの実体は `level` という属性をもつ整数ベクトルである.
```{r}
typeof(x.fac)
length(x.fac)
levels(x.fac)
```

関数 `class` によって因数ベクトルがであることが確認でき, `str` で属性を詳しく調べることができる.
```{r}
class(x.fac)
str(x.fac)
```

また水準の表示順は自動的にアルファベット順になるが, それを変更するには次のようにする.
```{r}
(x.factor <- factor(x,levels=c("S","M","L")))
```

この水準に順序構造を付与するには次のようにする.
```{r}
(x.order <- ordered(x,levels=c("S","M","L")))
```

## リスト
ベクトルなどを集めたものをリストという.
ベクトル型の違うベクトルを関数 `list` で集める.

リストの属性には長さがある.
```{r}
(lst <- list("a",c(3,3,2)))
typeof(lst)
length(lst)
```

関数 `class` によってリストがであることが確認でき, `str` で属性を詳しく調べることができる.
```{r}
class(lst)
str(lst)
```

また次のようにして名前の属性をつけられる.
```{r}
(lst <- list(name="a",num=c(3,3,2)))
names(lst)
```

リストの取りだすには次のようにする.
```{r}
lst[1]
```
名前の属性がついていれば以下のようにもできる.
```{r}
lst["num"]
```

いずれにせよ取り出したののもリストになることに注意されたい.
```{r}
typeof(lst[1])
typeof(lst["num"])
```

ベクトルとして取り出すには次のようにする.
```{r}
lst[[2]]
typeof(lst[[2]])
```
名前の属性がついていれば以下のようにもできる.
```{r}
lst[["num"]]
lst$num
```

リストとベクトルの違いとして, リスト自体もリストとして含められることがある.
```{r}
typeof(list("b",lst))
```

リストベクトルに変換するには `unlist` を用いる.
それぞれの型が違う場合, 同じ型に強制変換される.
```{r}
lst<-list(1:3,2:6)
lst
unlist(lst)
unlist(list("a",1:4))
```

## データフレイム
同じ長さのベクトルを組み合わせたリストをデータフレイム (dataframe) という.
`data.frame` で作成する.
```{r}
df <- data.frame(rnorm(10), 1:10)
typeof(df)
length(df)
```

関数 `class` によってデータフレイムがであることが確認でき, `str` で属性を詳しく調べることができる.
```{r}
class(df)
str(df)
```

リストと違い, 名前の属性は自動的に付けられる.
```{r}
names(df)
```

以下のようにして名前を指定してデータフレイムを作成できる.
```{r}
df <- data.frame(x=rnorm(10),y=rnorm(10))
names(df)
str(df)
```


データフレイムから変数を取り出すには
リストのときと同じように,
リストで示した `df["x"]`, `df[1]` とすればよい.
ただデータフレイムとして取り出すことになる.

ベクトルとして取り出すには,
リストで示した `df[["x"]]`, `df[[1]]` `df$x` とすればよい.


また`x` の特定の要素を取り出すには以下のようにする.
```{r}
df$x[5]
# df[["x"]][5], df[[1]][5]
# df[["x"]]["5"], df[[1]]["5"]
# df[5,"x"], df[5,1]
# df["5","x"], df["5",1]
```

データフレイムは統計分析の基本になる.
2つ注意点を挙げる.
まずデータフレイムのある変数の平均値を計算するには以下のようにする必要がある.
```{r}
mean(df$x)
with(df, mean(x))
```
また昔のRの本には `attach` を用いることを提唱している場合があるが,  
https://google.github.io/styleguide/Rguide.xml#attach  
にも書かれているように今はすすめられない. 


## まとめ
+ +, -, *, /, ^, %%, %/%
+ sqrt, exp, log, factorial, choose
+ abs, round, floor, ceiling
+ typeof, class, str
+ length, names, levels
+ c, factor, list, data.frame
+ cum, cumsum, prod, cumprod
+ mean, median, var, sd
+ sort, min, max, which.min, which.max
+ !, &, |, any, all
+ ==, >, <. !=, >=, <=
+ :, rep, seq, sample, rnorm, runif 

